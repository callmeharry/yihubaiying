<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <title>选择医生</title>

    <link type="text/css" rel="stylesheet" href="/javascripts/css/jquery.mmenu.all.css"/>
    <link type="text/css" rel="stylesheet" href="/javascripts/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="/stylesheets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/Order.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/mDoctor.css">

    <script type="text/javascript" src="/javascripts/js/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/js/jquery.mmenu.min.all.js"></script>
    <script type="text/javascript" src="/javascripts/js/o-script.js"></script>
</head>

<body class="o-page p-blog" onload="getCollectionState();">
<div id="page">

    <% if(!username) { %>
    <%- include mNotLoggedIn.html %>
    <% } else {%>
    <%- include mLoggedIn.html %>
    <% } %>


    <div id="content">
        <span style="display: none" id="id_hospitalId"><%= hospitalid %></span>
        <% for(var i = 0; i < doctor.length; i++) {%>
        <article>
            <div>
                <div style="float: left; width: 85px">
                    <img class="hospitalPic" src="doctor[i].imgsrc">
                </div>
                <div class="InfoDiv">
                    <span id="doctorName_id" name="doctorName"><%= doctor[i].name %></span>
                    <span style="display: none" name="id_doctorId"><%= doctor[i]._id %></span>
                    <div class="a-meta doctorInfoSytle">
                        <span class="doctorColumnHead">是否出诊：</span>
                        <span id="isOnDuty_id" name="isOnDuty"><%= doctor[i].isOnDuty%></span>
                    </div>
                    <div class="a-meta doctorInfoSytle">
                        <span class="doctorColumnHead">出诊时段,号源：</span>
								<span id="visitPeriod_id" name="visitPeriod">
									<% for (var j = 0; j < doctor[i].timeAndSource.length; j++) {%>
									<%= doctor[i].timeAndSource[j].time %> &nbsp; <%= doctor[i].timeAndSource[j].source %>
									<br/>
									<% } %>
								</span>
                    </div>
                    <div class="a-meta doctorInfoSytle">
                        <span class="doctorColumnHead">好评数：</span>
                        <span id="acceptedOrderNumber_id"
                              name="acceptedOrderNumber"><%= doctor[i].goodReputation%></span>
                    </div>
                    <div class="a-meta doctorInfoSytle">
                        <span class="doctorColumnHead">医生简介：</span>
                        <span id="doctorIntro_id" name="doctorIntro"><%= doctor[i].intro%></span>
                    </div>
                    <div class="a-meta doctorInfoSytle">
                        <span class="doctorColumnHead">医生专长：</span>
                        <span id="doctorSpecialty_id" name="doctorIntro"><%= doctor[i].advancedDisease%></span>
                    </div>
                    <button name="collection" style="background-color:#587eac; height:50px; width:80px;" id="collection_<%= doctor[i]._id %>" onclick="changeCollectionState(this)">收藏</button>

                    <a href="/mobile/book/time?hospitalid=<%= hospitalid %>&departmentid=<%= departmentid %>&doctorid=<%= doctor[i]._id %>&datenum=<%= datenum %>">选择</a>
                </div>

            </div>
        </article>




  <% } %>
    </div>
</div>
<script>
    function getCollectionState(){
        var user_id = getCookie('user_id');
        var hospital_id = document.getElementById("id_hospitalId").innerHTML;
        var doctor_id = document.getElementsByName("id_doctorId");
        for(var i = 0 ;i < doctor_id.length ; i++) {
            $.post("/getdoctorcollectionstate", {
                "user_id": user_id,
                "hospital_id": hospital_id,
                "doctor_id":doctor_id[i].innerHTML
            }, function (result) {
                if (result.status == 0) {
                    document.getElementById("collection_"+doctor_id[i].innerHTML).innerHTML = result;
                } else {
                    if (result.msg) {
                        alert(result.msg);
                    } else {
                        alert('服务器异常');
                    }
                }
            }, 'json');
        }

        return false;
    }
    function changeCollectionState(button){
        var user_id = getCookie('user_id');
        var hospital_id = document.getElementById("id_hospitalId").innerHTML;
        var doctor_id = button.id.split("_")[1];
        alert(doctor_id);
        $.post("/changedoctorcollectionstate", {
            "user_id": user_id,
            "hospital_id": hospital_id,
            "doctor_id":doctor_id[i].innerHTML
        }, function (result) {
            if (result.status == 0) {
                document.getElementById("collection_"+doctor_id[i].innerHTML).innerHTML = result;
            } else {
                if (result.msg) {
                    alert(result.msg);
                } else {
                    alert('服务器异常');
                }
            }
        }, 'json');
    }
    function getCookie(objName){//获取指定名称的cookie的值
        var arrStr = document.cookie.split("; ");
        for(var i = 0;i < arrStr.length;i ++){
            var temp = arrStr[i].split("=");
            if(temp[0] == objName) {
                var a = unescape(temp[1]);
                var c = a.split("\"");
                return c[1];
            }
        }
    }
</script>
</body>
</html> 