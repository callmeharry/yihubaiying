<%-include header.html%>

<!--中间部分-->
<div class="container">
   <div class="row">
      <!--左侧导航栏面板-->
      <div class="col-xs-3">
         <div class="panel panel-info panel-left">
            <div class="panel-heading">
               &nbsp;&nbsp;&nbsp;<a href="/person/info" class="panel-title"><%= user.real_name%></a>，您好！
            </div>
            <div class="panel-body">
               <ul class="nav nav-pills nav-stacked">
                  <li class="active"><a href="/person/myOrder">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我的订单</a></li>
                  <li><a href="/person/info">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;个人信息</a></li>
                  <li><a href="/person/myFavourite">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我的收藏</a></li>
                  <li><a href="/person/feedback">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;问题反馈</a></li>
               </ul>
               <button class="btn btn-default logout-button" type="button" href="/logout">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注&nbsp;&nbsp;&nbsp;&nbsp;销&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button>
            </div>
         </div>
      </div>
      <div class="col-xs-9">
         <!--右侧面板-->
         <div class="panel panel-info panel-right">
            <div class="panel-heading panel-head-center">
               <!--上方名字-->
               我的订单
            </div>
            <div class="panel-body panel-body-center">
               <table class="table table-striped">
                  <thead>
                  <tr>
                     <th>订单编号</th>
                     <th>医院</th>
                     <th>挂号科室</th>
                     <th>就诊医师</th>
                     <th>就诊日期</th>
                     <th>就诊号</th>
                     <th>操作</th>
                  </tr>
                  </thead>
                  <tbody>
                  <% for(var i=0; i<orders.length; i++) {%>
                  <tr>
                     <td><%= orders[i].order_time %></td>
                     <td><%= orders[i].hospital_name %></td>
                     <td><%= orders[i].dept_name %></td>
                     <td><%= orders[i].doctor_name %></td>
                     <td><%= orders[i].order_see_time %></td>
                     <td><%= orders[i].order_number %></td>
                     <td>
                        <button type="button" class="btn btn-default btn-xs">打印</button>
                        <button type="button" data-toggle="modal" data-target="#assessModal<%= i%>" class="btn btn-default btn-xs">评价</button>
                        <button type="button" data-toggle="modal" data-target="#myModal<%= i%>" class="btn btn-default btn-xs">删除</button>
                     </td>
                     <!-- Modal -->
                     <div class="modal fade" id="assessModal<%= i%>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                           <form action="/person/assessOrder" method="post">
                              <div class="modal-content">
                                 <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                 </div>
                                 <div class="modal-body">
                                    <label class="th-label">评价订单：</label>
                                    <textarea placeholder="请写下您对于该订单的评价" name = "content"></textarea>
                                 </div>
                                 <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    <button type="submit" class="btn btn-primary">提交</button>
                                 </div>
                              </div><!-- /.modal-content -->
                           </form>
                        </div><!-- /.modal-dialog -->
                     </div><!-- /.modal -->
                     <!-- Modal -->
                     <div class="modal fade" id="myModal<%= i%>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                           <div class="modal-content">
                              <div class="modal-header">
                                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                              </div>
                              <div class="modal-body">
                                 <h4 class="error-text"><span class="glyphicon glyphicon-warning-sign"></span>确定要删除该订单吗？</h4>
                              </div>
                              <div class="modal-footer">
                                 <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                 <button type="button" class="btn btn-primary del" id="<%= orders[i].order_id %>" >删除</button>
                              </div>
                           </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                     </div><!-- /.modal -->
                  </tr>
                  <% } %>
                  </tbody>
               </table>
            </div>
         </div>
      </div>
   </div>
</div>
<script>
   $(document).ready(function() {
      $('button.del').click(function(){
         var order_id = $(this).attr("id");
         $.post("/person/dropOrder",{"order_id":order_id},function(result) {
            if (result.status == 0) {
               window.location.reload();
            } else {
               if (result.msg) {
                  alert(result.msg);
               } else {
                  alert('服务器异常');
               }
            }
         },'json');
         return false;
      });
   });
</script>
</body>
</html>